# 開発フロー

## 基本原則

- **1機能 = 複数Issue** （レイヤー別に分割）
- **1Issue = 1レイヤー = 1PR** 
- **開発順序**: ボトムアップ（DB → Domain → Repository → Service → API → UI → Integration）

## Issue作成フロー

### 1. 機能分析とIssue分割

新機能実装時は、まず **レイヤー別にIssueを分割** します。

**例：メンバー登録機能の場合**
```
メンバー登録機能 (Epic)
├── [DB] メンバーテーブル作成 (#001)
├── [Domain] Memberエンティティ実装 (#002)  
├── [Repository] MemberRepository実装 (#003)
├── [Service] MemberService実装 (#004)
├── [API] メンバー登録API実装 (#005)
├── [UI] メンバー登録画面実装 (#006)
└── [Integration] API-UI連携実装 (#007)
```

### 2. Issue作成の具体的手順

1. **Epic Issue作成** （機能全体の概要）
   - 機能の概要と目的
   - 関連する仕様書（SPEC.md）
   - 分割予定のIssue一覧

2. **レイヤー別Issue作成** （開発順序に従って）
   - Issueテンプレートを活用
     - 機能実装：.github/ISSUE_TEMPLATE/feature_request.yml
     - バグ修正：.github/ISSUE_TEMPLATE/bug_report.yml
   - 各Issueに以下を明記：
     - 実装対象レイヤー（[DB], [Domain], [Repository]等）
     - 前提となる依存Issue
     - 関連する仕様書
     - 完了条件（Definition of Done）

### 3. Issue内容の必須項目

#### 基本情報
- **レイヤーラベル**: [DB], [Domain], [Repository], [Service], [API], [UI], [Integration]
- **優先度**: High/Medium/Low

#### 依存関係
```markdown
## 依存Issue（実装前に完了必須）
- #001: メンバーテーブル作成
- #002: Memberエンティティ実装

## 後続Issue（本Issue完了後に着手可能）
- #005: メンバー登録API実装
```

#### 実装内容
- **参照仕様**: specs/内の具体的ファイル
- **実装範囲**: 具体的なクラス・メソッド

#### 完了条件
```markdown
## Definition of Done
- [ ] 仕様通りの機能実装
- [ ] 単体テスト実装（カバレッジ80%以上）
- [ ] コードレビュー完了
- [ ] 関連ドキュメント更新
- [ ] 統合テスト通過（該当する場合）
```

## 開発実行フロー

### 1. 開発順序の決定

**基本順序（ボトムアップ）**:
```
1. [DB] データベース設計・DDL作成・マイグレーション
   ↓
2. [Domain] エンティティ・ドメインモデル
   ↓  
3. [Repository] データアクセス層
   ↓
4. [Service] ビジネスロジック層
   ↓
5. [API] RESTエンドポイント
   ↓
6. [UI] フロントエンド画面
   ↓
7. [Integration] フロント・バック連携
```

**例外ケース（トップダウン）**:
- プロトタイプ開発時
- UI/UX確認優先時
- モックAPI使用時

### 2. Issue着手ルール

#### 着手前チェック
- [ ] 依存Issueがすべて完了している
- [ ] 必要な仕様書が整備されている  
- [ ] 開発環境が準備できている

#### ブランチ作成
```bash
# ブランチ命名規則
feature/<issue-id>-<layer>-<summary>

# 例
feature/005-api-member-registration
feature/006-ui-member-registration  
```

### 3. Pull Request作成

#### PR作成時の必須項目
- **Issue番号**: Closes #XXX で自動クローズ設定
- **実装内容**: 変更点の概要
- **テスト**: 追加・修正したテスト内容
- **レビュー観点**: 特に注意してほしい点

#### PRサイズ制限
- **最大200行/PR** （コード+テスト含む）
- 大きくなる場合は更に細分化

### 4. コードレビュー

#### レビュー観点
1. **アーキテクチャ準拠**: docs/architecture.md
2. **コーディング規約**: docs/conventions.md  
3. **セキュリティ**: docs/policies.md
4. **テストカバレッジ**: 80%以上
5. **パフォーマンス**: N+1クエリ等の問題なし

#### レビュー完了条件
- [ ] 1名以上のApprove
- [ ] CI/CDパス
- [ ] 競合（コンフリクト）なし

### 5. マージとクリーンアップ

1. **マージ**: Squash and Merge推奨
2. **ブランチ削除**: マージ後は速やかに削除
3. **後続Issue開始**: 依存関係に基づき次のIssue着手

## トラブルシューティング

### Issue粒度が大きすぎる場合
- **分割基準**: 1つのPRが200行を超える見込みの場合は分割
- **再分割**: より細かいレイヤー・機能単位で分割

### 依存関係でブロックされる場合
- **並行開発**: 独立した機能は並行実装可能
- **モック対応**: 依存部分をモック化して先行実装
- **順序変更**: 可能であれば実装順序を調整

### レビュー効率化
- **小さなPR**: 細かい粒度でレビュー負荷軽減
- **セルフレビュー**: PR作成前に自分でチェック
- **自動化**: 可能な部分はCI/CDで自動チェック
