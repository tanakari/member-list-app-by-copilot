# AIエージェント作業契約（Working Agreement for AI Agent）

本プロジェクトは **AI駆動開発** を想定します。変更は **小さく・差分で・理由とロールバック併記** を原則とします。

## 契約（ポリシー）

- **1 Issue = 1 PR**。`main` 直 push は禁止
- `.env` など **Secrets は Git 管理しない**（API Key / Token / 個人情報をコミットしない）
- 命名・コーディング規約／アーキテクチャ指針を遵守

## 出力形式（厳守）

1. **要約（3行以内）** — 何を、なぜ、どう変えるか
2. **手順（番号付き）** — 編集ファイル／コマンド／ブランチ名案（例：`feature/<issue-id>-<summary>`）
3. **差分（unified diff）** — ファイル別、**最大 200 行/PR**
4. **ロールバック** — 元に戻す具体手順（コマンドや差分）
5. **根拠・注意点** — 採用理由／代替案／失敗しやすい点（3つ）
6. **参照** — `docs/SPEC.md` の該当節、関連 Issue / PR へのリンク

## 制約（Constraints）

- **Secrets／個人情報は扱わない**
- 破壊的変更は **提案のみ**（既存は残す／新規を併置）
- 依存追加は **採用理由・代替案・アンインストール手順** を併記

## Issue粒度とレイヤー開発の原則

### Issue粒度の基準
- **1 Issue = 1レイヤー = 1責務** を基本とする
- 1つのIssueは **単一のレイヤー** に集中（DB, Domain, Repository, Service, API, UI）
- **最大実装量**: 1PR = 200行以下
- **完了時間**: 1Issueは **半日〜1日** で完了できる粒度

### レイヤー別Issue例
```
[DB] メンバーテーブル作成        → DDL・制約・インデックス
[Domain] Memberエンティティ実装  → ドメインモデル・バリデーション  
[Repository] MemberRepository実装 → データアクセス処理
[Service] MemberService実装     → ビジネスロジック
[API] メンバー登録API実装       → RESTエンドポイント
[UI] メンバー登録画面実装       → HTML・CSS・JavaScript
[Integration] API-UI連携実装    → フロント・バック統合
```

### 開発順序の原則
**基本**: ボトムアップ開発（DB → Domain → Repository → Service → API → UI → Integration）

1. **データベース層** → テーブル設計・DDL
2. **ドメイン層** → エンティティ・バリデーション
3. **リポジトリ層** → データアクセス
4. **サービス層** → ビジネスロジック  
5. **API層** → RESTエンドポイント
6. **UI層** → 画面実装
7. **統合層** → フロント・バック連携

**例外**: プロトタイプ・UI確認優先の場合はトップダウンも可

### 依存関係の管理
- **前提Issue**: 実装に必要な依存Issueを明記
- **後続Issue**: 完了後に実装可能になるIssueを記載  
- **ブロック管理**: 依存Issueが未完了の場合は待機

## 完了条件（Definition of Done）

- 本作業契約の **出力形式**に準拠し、差分は **200 行以下**
- 必要に応じてフォーマッタ／静的解析を通過
- `docs/SPEC.md` の該当節を参照し、README／INSTRUCTIONS からの導線がある
- 必要に応じて **テスト**を追加し、**再現手順**を明示